# 安装和测试指南

## 🚀 安装步骤

### 步骤 1: 准备工作

**检查清单**:
- ✅ 已安装 utools（版本 >= 2.0.0）
- ✅ 已下载/克隆本项目
- ✅ 已准备阿里云 DashScope API Key

### 步骤 2: 创建图标（可选但推荐）

在项目根目录创建 `logo.png` 文件：
- 尺寸: 256x256 或 512x512 像素
- 格式: PNG（支持透明背景）
- 配色: 建议紫蓝色系 (#667eea, #764ba2)

**临时方案**: 如果暂无图标，可以先注释掉 plugin.json 中的 logo 配置。

### 步骤 3: 在 utools 中安装

**方法 A: 开发者模式（推荐用于测试）**

```bash
1. 打开 utools
2. 按 Ctrl+I (Windows/Linux) 或 Cmd+I (macOS)
3. 点击右上角齿轮图标
4. 选择"开发者工具"
5. 点击"导入开发插件"
6. 选择本项目的根目录
7. 等待导入完成
```

**方法 B: 打包安装**

```bash
# 在项目根目录执行
cd /path/to/web_search_ai_assisstant

# 创建 .upx 包（实际上就是 zip）
zip -r ../ai-assistant.upx . -x "*.git*" "*.DS_Store" "node_modules/*"

# 在 utools 中
1. 按 Ctrl+I 或 Cmd+I
2. 选择"从本地安装"
3. 选择刚才创建的 .upx 文件
```

### 步骤 4: 验证安装

在 utools 主界面输入以下任一关键词：
- `AI`
- `ai`
- `通义`
- `千问`
- `对话`

如果出现插件图标和名称，说明安装成功！✅

## 🧪 功能测试

### 测试 1: 基础配置

1. 输入 `AI设置` 打开设置页面
2. 检查页面是否正常显示
3. 输入测试 API Key（或真实的）
4. 选择模型：qwen-plus
5. 点击"验证 API Key"
6. 观察验证结果

**预期结果**: 
- ✅ 设置页面正常显示
- ✅ API Key 验证成功/失败提示清晰

### 测试 2: 主题切换

1. 在设置页面选择"深色"主题
2. 保存设置
3. 返回主界面
4. 检查主题是否应用

**预期结果**:
- ✅ 主题成功切换
- ✅ 颜色对比度良好
- ✅ 所有元素可见

### 测试 3: 基础对话

1. 输入 `AI` 启动插件
2. 在输入框输入: "你好，介绍一下你自己"
3. 按 Enter 发送
4. 观察回复

**预期结果**:
- ✅ 消息成功发送
- ✅ 看到流式回复（逐字显示）
- ✅ 回复内容合理
- ✅ 消息格式正确

### 测试 4: 多轮对话

继续在上一个对话中：
1. 输入: "你有什么能力？"
2. 等待回复
3. 输入: "给我讲个笑话"

**预期结果**:
- ✅ AI 能记住上下文
- ✅ 回复连贯
- ✅ 对话历史正确显示

### 测试 5: 网络搜索（如果配置了支持搜索的模型）

1. 确保使用 qwen-plus-latest 或 qwen-max-latest
2. 确保启用了"网络搜索"
3. 输入: "今天的日期是？"
4. 等待回复

**预期结果**:
- ✅ 返回当前日期
- ✅ 显示搜索指示器
- ✅ 回复包含实时信息

### 测试 6: Markdown 和代码高亮

输入以下消息:
```
写一个 Python 函数计算斐波那契数列
```

**预期结果**:
- ✅ 代码块正确渲染
- ✅ 语法高亮正常
- ✅ 可以复制代码

### 测试 7: 对话管理

1. 点击左上角 ➕ 按钮创建新对话
2. 在新对话中发送消息
3. 点击侧边栏切换回之前的对话
4. 检查对话内容是否保留

**预期结果**:
- ✅ 能创建新对话
- ✅ 对话可以正常切换
- ✅ 历史内容完整保留

### 测试 8: 清空对话

1. 点击右上角 🗑️ 按钮
2. 确认清空
3. 检查对话是否清空

**预期结果**:
- ✅ 对话成功清空
- ✅ 欢迎屏幕重新显示

### 测试 9: 删除对话

1. 创建多个对话
2. 鼠标悬停在侧边栏的某个对话上
3. 点击出现的 🗑️ 按钮
4. 确认删除

**预期结果**:
- ✅ 对话成功删除
- ✅ 自动切换到其他对话

### 测试 10: 数据导入导出

1. 打开设置页面
2. 点击"导出对话历史"
3. 检查下载的 JSON 文件
4. 点击"导入对话历史"
5. 选择刚才导出的文件

**预期结果**:
- ✅ 成功导出 JSON 文件
- ✅ JSON 格式正确
- ✅ 成功导入数据

### 测试 11: 快捷键

测试以下快捷键：
- `Ctrl/Cmd + Enter`: 发送消息
- `Ctrl/Cmd + N`: 新建对话
- `Ctrl/Cmd + K`: 清空对话
- `Esc`: 隐藏窗口

**预期结果**:
- ✅ 所有快捷键正常工作

### 测试 12: 停止生成

1. 发送一个需要较长回复的问题
2. 在回复过程中点击"停止"按钮
3. 观察是否停止

**预期结果**:
- ✅ 回复立即停止
- ✅ 已生成的内容保留
- ✅ 可以继续发送新消息

## 🔍 边界测试

### 测试 A: 空消息
尝试发送空消息

**预期**: 不应发送，没有错误

### 测试 B: 超长消息
发送一段很长的文本（1000+ 字）

**预期**: 正常发送和回复

### 测试 C: 特殊字符
发送包含特殊字符的消息: `<script>alert(1)</script>`

**预期**: 正确转义，不执行脚本

### 测试 D: 网络断开
断开网络连接后发送消息

**预期**: 显示友好的错误提示

### 测试 E: API Key 错误
使用错误的 API Key

**预期**: 显示认证失败提示

### 测试 F: 快速连续发送
快速连续点击发送按钮

**预期**: 防止重复发送，或正确排队

## 📊 测试报告模板

```markdown
## 测试环境
- 操作系统: [Windows 10 / macOS 14 / Ubuntu 22.04]
- utools 版本: [2.x.x]
- 插件版本: 1.0.0
- 测试日期: [YYYY-MM-DD]

## 测试结果

| 测试项 | 状态 | 备注 |
|--------|------|------|
| 安装 | ✅/❌ |  |
| 基础配置 | ✅/❌ |  |
| 主题切换 | ✅/❌ |  |
| 基础对话 | ✅/❌ |  |
| 多轮对话 | ✅/❌ |  |
| 网络搜索 | ✅/❌ |  |
| Markdown 渲染 | ✅/❌ |  |
| 对话管理 | ✅/❌ |  |
| 数据导入导出 | ✅/❌ |  |
| 快捷键 | ✅/❌ |  |

## 发现的问题
1. [描述问题]
2. [描述问题]

## 建议改进
1. [改进建议]
2. [改进建议]
```

## 🐛 常见问题排查

### 问题 1: 插件无法加载

**可能原因**:
- plugin.json 格式错误
- 缺少必需文件
- logo.png 不存在（如配置了 logo）

**解决方案**:
1. 检查 plugin.json 是否是有效的 JSON
2. 确认所有文件都存在
3. 注释掉 logo 配置或添加 logo 文件

### 问题 2: API 调用失败

**可能原因**:
- API Key 错误
- 网络问题
- 模型不存在
- 账号余额不足

**解决方案**:
1. 验证 API Key 是否正确
2. 检查网络连接
3. 尝试其他模型
4. 检查阿里云账户余额

### 问题 3: 流式响应不显示

**可能原因**:
- 浏览器兼容性问题
- JavaScript 错误

**解决方案**:
1. 打开开发者工具查看错误
2. 检查是否加载了所有必需的库
3. 尝试刷新页面

### 问题 4: 主题切换无效

**可能原因**:
- CSS 未正确加载
- 配置保存失败

**解决方案**:
1. 清空浏览器缓存
2. 重新保存配置
3. 检查 CSS 文件是否存在

### 问题 5: 对话历史丢失

**可能原因**:
- 存储失败
- 数据被清空

**解决方案**:
1. 检查存储权限
2. 定期导出备份
3. 查看浏览器存储容量

## 📝 性能测试

### 响应时间测试

测量以下操作的时间：
1. 插件启动时间
2. 发送消息到首次响应
3. 对话切换时间
4. 主题切换时间

**建议标准**:
- 启动 < 1s
- 首次响应 < 2s
- 对话切换 < 300ms
- 主题切换 < 200ms

### 内存使用测试

1. 打开任务管理器/活动监视器
2. 记录启动时内存
3. 进行 20 轮对话
4. 记录当前内存

**建议标准**: 增长不超过 50MB

## ✅ 发布前检查清单

- [ ] 所有功能测试通过
- [ ] 边界测试通过
- [ ] 多平台测试通过
- [ ] 性能测试达标
- [ ] 文档完整准确
- [ ] 已创建 logo.png
- [ ] 更新了版本号
- [ ] 更新了 README 中的联系方式

## 🎉 测试通过后

如果所有测试都通过：

1. **打包发布**
```bash
zip -r ai-assistant-v1.0.0.upx . -x "*.git*" "*.DS_Store"
```

2. **发布到 utools 插件市场**
   - 访问 utools 开发者中心
   - 上传 .upx 文件
   - 填写插件信息
   - 提交审核

3. **GitHub 发布**
   - 创建 Release
   - 上传 .upx 文件
   - 编写更新日志

---

祝测试顺利！如有问题欢迎反馈。🚀

