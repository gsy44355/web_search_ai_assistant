# 问题排查指南

## 当前问题
**现象：** 选择"向 AI 提问"后，没有看到任何 `console.log` 输出，只有 "插件已就绪" 和 "插件已退出"。

**原因分析：** `enter` 回调没有被触发，说明 utools 没有正确调用 ai_ask 功能。

## 排查步骤

### 步骤 1: 验证插件是否正确加载

1. 打开 utools
2. 输入 `AI` 或 `ai`
3. 能否看到 "AI 联网对话" 选项？
   - ✅ 如果能看到，说明插件加载成功，进入步骤 2
   - ❌ 如果看不到，说明插件没有加载，需要检查 plugin.json

### 步骤 2: 测试基础功能是否正常

1. 输入 `AI` 并回车进入插件
2. 能否正常使用对话功能？
   - ✅ 如果能，说明基础功能正常，问题在 ai_ask 功能
   - ❌ 如果不能，说明插件整体有问题

### 步骤 3: 查看 utools 插件列表

1. 在 utools 中输入 `插件管理` 或 `plugins`
2. 找到 "通义千问 AI 助手"
3. 查看插件信息：
   - 版本号是否正确？
   - 是否显示了所有功能（应该有 3 个功能）？

### 步骤 4: 尝试不同的触发方式

#### 方式 A: 选中文本（推荐先测试这个）

1. 在任何地方（浏览器、记事本等）选中一段文本
   ```
   今天天气怎么样
   ```
2. 按快捷键呼出 utools（通常是 Alt+Space 或 Cmd+Space）
3. 应该看到 "使用AI进行web搜索" 选项
4. 选择该选项
5. **观察控制台**（F12），应该看到：
   ```
   ========== 进入 AI 提问 ==========
   ```

#### 方式 B: 直接在 utools 输入

1. 呼出 utools
2. 输入任意内容（不要输入 AI、ai 等关键词）
   ```
   今天天气怎么样
   ```
3. 看看列表中有没有显示 "向AI提问" 相关的选项
4. 如果有，选择它并观察控制台

### 步骤 5: 检查 plugin.json

打开 `plugin.json`，确认内容如下：

```json
{
  "features": [
    {
      "code": "ai_chat",
      "explain": "AI 联网对话",
      "cmds": ["AI", "ai", "通义", "千问", "对话"]
    },
    {
      "code": "ai_ask",
      "explain": "向 AI 提问",
      "cmds": [
        {
          "type": "over",
          "label": "使用AI进行web搜索"
        },
        {
          "type": "input",
          "label": "向AI提问 - {query}",
          "placeholder": "输入你的问题"
        }
      ]
    },
    {
      "code": "ai_settings",
      "explain": "AI 设置",
      "cmds": ["AI设置", "ai设置"]
    }
  ]
}
```

## 常见问题

### Q1: 为什么没有看到 "========== 进入 AI 提问 ==========" 日志？

**A:** 这说明 `enter` 回调没有被触发。可能原因：

1. **功能没有被正确注册**
   - 解决：在 utools 中卸载并重新安装插件
   - 步骤：utools → 插件管理 → 找到插件 → 卸载 → 重新安装

2. **utools 版本太旧**
   - 某些功能类型需要较新版本的 utools
   - 解决：更新 utools 到最新版本

3. **插件缓存问题**
   - 解决：清除 utools 缓存
   - 在 utools 中输入 `清除缓存`

### Q2: 选中文本后没有显示 "使用AI进行web搜索" 选项

**A:** `type: "over"` 可能没有生效。尝试：

1. 确保选中了文本（文本应该是高亮状态）
2. 立即按快捷键呼出 utools（不要点击其他地方）
3. 如果还是不显示，可能是 utools 版本不支持

### Q3: 输入内容后没有显示 "向AI提问" 选项

**A:** `type: "input"` 可能需要特定的配置。这个类型在不同版本的 utools 中表现可能不同。

## 临时解决方案

如果以上方法都不行，我们可以使用更简单的配置：

### 方案 1: 使用关键词触发

修改 `plugin.json` 中的 `ai_ask` 部分：

```json
{
  "code": "ai_ask",
  "explain": "向 AI 提问",
  "cmds": ["问", "搜", "search"]
}
```

然后在 utools 中输入：
```
问 今天天气怎么样
```

### 方案 2: 只保留选中文本功能

```json
{
  "code": "ai_ask",
  "explain": "使用AI进行web搜索",
  "cmds": [
    {
      "type": "over",
      "label": "使用AI进行web搜索"
    }
  ]
}
```

## 下一步

如果以上所有方法都尝试了还是不行，请提供以下信息：

1. **utools 版本号**
   - 在 utools 中输入 `关于` 查看版本

2. **操作系统**
   - macOS / Windows / Linux

3. **具体操作步骤**
   - 详细描述您是如何操作的

4. **控制台的所有输出**
   - 包括任何错误信息

5. **选中文本测试结果**
   - 选中文本后，在 utools 列表中能看到哪些选项？
   - 截图更佳

---

**提示：** 如果您只需要选中文本后搜索的功能，方案 2 是最简单可靠的。如果您需要在 utools 中直接输入问题，我们需要找到您的 utools 版本支持的正确配置方式。

